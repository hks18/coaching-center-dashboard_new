<!DOCTYPE html>
<html>
<head>
    <title>Center Dashboard</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <style>
      body { background-color: #f5f5f5; }
      .excel-table th,
      .excel-table td {
        vertical-align: middle;
        font-size: 0.9rem;
      }
      .excel-table thead th {
        background-color: #e9ecef;
      }
    </style>
</head>
<body>
  <div class="container mt-4 mb-5">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h3 class="mb-1">Center Dashboard – {{ center_label }}</h3>
        <p class="small text-muted mb-0">
          Select a date and/or search by username to see details.
        </p>
      </div>
      <div>
        <a href="/home/" class="btn btn-outline-secondary btn-sm">Back to Home</a>
      </div>
    </div>

    <!-- Filters (search + date) -->
    <form method="get" class="card shadow-sm p-3 mb-3">
      <div class="row g-2 align-items-end">
        <div class="col-md-4">
          <label class="form-label mb-1">Search user</label>
          <input
            type="text"
            name="q"
            class="form-control"
            placeholder="Enter username"
            value="{{ search }}"
          />
        </div>

        <div class="col-md-4">
          <label class="form-label mb-1">Select date</label>
          <input
            type="date"
            name="date"
            class="form-control"
            value="{{ selected_date|date:'Y-m-d' }}"
          />
        </div>

        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">
            Apply filters
          </button>
        </div>

        <div class="col-md-2">
          <a href="/center-dashboard/" class="btn btn-outline-secondary w-100">
            Clear
          </a>
        </div>
      </div>

      <div class="mt-2 small text-muted">
        Showing data for: <strong>{{ selected_date }}</strong>
      </div>
    </form>

    <!-- Excel-style table -->
    <div class="card shadow-sm">
      <div class="card-body p-2">
        <div class="table-responsive">
          <table class="table table-bordered table-sm excel-table mb-0">
            <thead>
              <tr>
                <th style="width:4%;">#</th>
                <th style="width:15%;">Username</th>
                <th style="width:12%;">Status (last 7 days)</th>
                <th style="width:10%;">Date</th>
                <th style="width:10%;">No. of customers</th>
                <th>Customer details (Name – Phone)</th>
              </tr>
            </thead>
            <tbody>
              {% if users_data %}
                {% for u in users_data %}
                  <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ u.username }}</td>
                    <td>
                      {% if u.status == 'Active' %}
                        <span class="badge bg-success">Active</span>
                      {% else %}
                        <span class="badge bg-secondary">Inactive</span>
                      {% endif %}
                    </td>
                    <td>{{ selected_date }}</td>
                    <td>{{ u.count }}</td>
                    <td>
                      {% if u.customers %}
                        <table class="table table-borderless table-sm mb-0">
                          <thead>
                            <tr>
                              <th style="width:50%;">Name</th>
                              <th style="width:50%;">Phone</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for c in u.customers %}
                              <tr>
                                <td>{{ c.name }}</td>
                                <td>{{ c.phone }}</td>
                              </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      {% else %}
                        <span class="text-muted">No customers on this date</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="6" class="text-center text-muted">
                    No users found for this filter.
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
