
<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <style>
      body { position: relative; min-height: 100vh; }
      .calendar-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 260px;
      }
    </style>
</head>
<body class="bg-light">
  <div class="container mt-4 mb-5">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div class="card shadow p-3 me-2 flex-grow-1">
        <h2 class="mb-2">
          Welcome {{ role_label }} {{ request.user.username }} of {{ center_label }} ðŸŽ‰
        </h2>
        <p class="mb-1">
          Status: <strong>{{ streak_status_text }}</strong>
        </p>
        <p class="small text-muted mb-0">
          Active user = last 7 days (including today) have at least 3 customers each day.
        </p>
      </div>
      {% if is_centerowner %}
      <div>
        <a href="/center-dashboard/" class="btn btn-outline-primary">Center Dashboard</a>
      </div>
      {% endif %}
    </div>

    {% if message %}
      <div class="alert alert-success">{{ message }}</div>
    {% endif %}
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <div class="row">
      <div class="col-md-7 mb-3">
        <div class="card shadow-sm p-3 mb-3">
          <h5 class="mb-3">
            Customers for {{ selected_date }}{% if selected_date == today %} (Today){% endif %}
          </h5>

          {% if customers %}
            <div class="table-responsive">
              <table class="table table-sm table-striped align-middle">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Phone</th>
                  </tr>
                </thead>
                <tbody>
                  {% for c in customers %}
                    <tr>
                      <td>{{ forloop.counter }}</td>
                      <td>{{ c.name }}</td>
                      <td>{{ c.phone }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="text-muted mb-0">No customers logged for this day.</p>
          {% endif %}
        </div>

        <div class="card shadow-sm p-3">
          <h5 class="mb-2">Last 7 days summary</h5>
          <div class="table-responsive">
            <table class="table table-sm table-bordered align-middle mb-0">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Customers</th>
                </tr>
              </thead>
              <tbody>
                {% for d, c in streak_dates_counts %}
                  <tr>
                    <td>{{ d }}</td>
                    <td>{{ c }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-md-5 mb-3">
        <div class="card shadow-sm p-3">
          <h5 class="mb-3">Add customers for today</h5>
          {% if selected_date != today %}
            <p class="text-muted">
              You can only add or change customers for <strong>today ({{ today }})</strong>.<br />
              Use the calendar to switch back to today to add more.
            </p>
          {% else %}
            <form method="POST">
              {% csrf_token %}

              <p class="small text-muted">
                Minimum <strong>3</strong> customers on a new day, maximum <strong>25</strong> per day.<br>
                You can add more customers during the day, but cannot delete older ones.
              </p>

              <div id="customers-container">
                <div class="row g-2 mb-2 customer-row">
                  <div class="col-6">
                    <input type="text" name="customer_name" class="form-control" placeholder="Customer 1 name" required />
                  </div>
                  <div class="col-6">
                    <input type="text" name="customer_phone" class="form-control" placeholder="Customer 1 phone" required />
                  </div>
                </div>
                <div class="row g-2 mb-2 customer-row">
                  <div class="col-6">
                    <input type="text" name="customer_name" class="form-control" placeholder="Customer 2 name" required />
                  </div>
                  <div class="col-6">
                    <input type="text" name="customer_phone" class="form-control" placeholder="Customer 2 phone" required />
                  </div>
                </div>
                <div class="row g-2 mb-2 customer-row">
                  <div class="col-6">
                    <input type="text" name="customer_name" class="form-control" placeholder="Customer 3 name" required />
                  </div>
                  <div class="col-6">
                    <input type="text" name="customer_phone" class="form-control" placeholder="Customer 3 phone" required />
                  </div>
                </div>
              </div>

              <button type="button" class="btn btn-outline-secondary btn-sm mb-2" id="add-more-btn">
                + Add one more
              </button>

              <div>
                <button type="submit" class="btn btn-primary w-100 mt-2">Save today's customers</button>
              </div>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar bottom-right -->
  <div class="calendar-widget card shadow p-3">
    <h6 class="mb-2">Select a date</h6>
    <form method="get">
      <input
        type="date"
        name="date"
        class="form-control mb-2"
        value="{{ selected_date|date:'Y-m-d' }}"
      />
      <button type="submit" class="btn btn-sm btn-outline-primary w-100">View day</button>
    </form>
    <p class="small text-muted mt-2 mb-0">
      Click a date and press "View day" to see customers for that day.
    </p>
  </div>

  <script>
    (function() {
      const addBtn = document.getElementById('add-more-btn');
      const container = document.getElementById('customers-container');
      if (addBtn && container) {
        addBtn.addEventListener('click', function() {
          const rows = container.getElementsByClassName('customer-row').length;
          if (rows >= 25) return;
          const num = rows + 1;
          const wrapper = document.createElement('div');
          wrapper.className = 'row g-2 mb-2 customer-row';
          wrapper.innerHTML = `
            <div class="col-6">
              <input type="text" name="customer_name" class="form-control" placeholder="Customer ${num} name" required />
            </div>
            <div class="col-6">
              <input type="text" name="customer_phone" class="form-control" placeholder="Customer ${num} phone" required />
            </div>
          `;
          container.appendChild(wrapper);
        });
      }
    })();
  </script>
</body>
</html>
